<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>4 Creating unit tests for domain classes 0.2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/gettingStarted.html"><strong>2</strong><span>Getting started</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/config.html"><strong>3</strong><span>Setting up the configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestDomainClasses.html"><strong>4</strong><span>Creating unit tests for domain classes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/services.html"><strong>5</strong><span>Creating services</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestServices.html"><strong>6</strong><span>Creating unit tests for services</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/logsServices.html"><strong>7</strong><span>Creating logs for services</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/controllers.html"><strong>8</strong><span>Creating controllers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestControllers.html"><strong>9</strong><span>Creating unit tests for controllers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/views.html"><strong>10</strong><span>Creating views</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>Grails Optimus Plugin</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/config.html">&lt;&lt; <strong>3</strong><span>Setting up the configuration</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/services.html"><strong>5</strong><span>Creating services</span> >></a></div>
                


                <div class="project">
                    <h1>4 Creating unit tests for domain classes - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Alejandro Garc√≠a Granados</p>

                    <p><strong>Version:</strong> 0.2</p>

                    
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#spockUnitTestDomainClasses"><strong>4.1</strong><span>Creating unit tests with Spock</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="unitTestDomainClasses">4 Creating unit tests for domain classes</h1>
Testing domain class constraints is important. It contains logic that you should test if you want to prevent some very common errors, such as typos.<p class="paragraph"/>The Optimus plugin can do this for you with the <a href="../ref/Scripts/create-unit-test-constraints.html" class="Scripts">create-unit-test-constraints</a> command:
<div class="code"><pre>grails create&#45;unit&#45;test&#45;constraints &#91;domainClass&#93;</pre></div>
Suppose you have a domain class like this:
<div class="code"><pre><span class="java&#45;keyword">package</span> mypackage<p class="paragraph"/>class Person &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> name
    <span class="java&#45;object">String</span> lastName
    Date birthdate
    <span class="java&#45;object">Boolean</span> enabled<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        name blank:<span class="java&#45;keyword">false</span>, size:1..100
        lastName blank:<span class="java&#45;keyword">false</span>, size:1..100
    &#125;<p class="paragraph"/>&#125;</pre></div>
With the <a href="../ref/Scripts/create-unit-test-constraints.html" class="Scripts">create-unit-test-constraints</a> command, you will get the following unit test files:
<ul class="star">
<li><code>test/unit/mypackage/PersonNameConstraintsTests.groovy</code></li>
<li><code>test/unit/mypackage/PersonLastNameConstraintsTests.groovy</code></li>
<li><code>test/unit/mypackage/PersonBirthdateConstraintsTests.groovy</code></li>
<li><code>test/unit/mypackage/PersonEnabledConstraintsTests.groovy</code></li>
</ul><p class="paragraph"/>If we open the <code>test/unit/mypackage/PersonNameConstraintsTests.groovy</code> file, we will find something like this:
<div class="code"><pre><span class="java&#45;keyword">package</span> mypackage<p class="paragraph"/><span class="java&#45;keyword">import</span> grails.test.mixin.&#42;
<span class="java&#45;keyword">import</span> org.junit.&#42;<p class="paragraph"/>@TestFor(Person)
class PersonNameConstraintsTests &#123;<p class="paragraph"/>    @Before
    void setUp() &#123;
        mockForConstraintsTests( Person, &#91; <span class="java&#45;keyword">new</span> Person() &#93; )
    &#125;<p class="paragraph"/>    void testBlank() &#123;<p class="paragraph"/>        def instance = <span class="java&#45;keyword">new</span> Person()
        instance.name = ''
        assertFalse <span class="java&#45;quote">"'validate' should be <span class="java&#45;keyword">false</span>"</span>, instance.validate()
        assertNotNull <span class="java&#45;quote">"'errors&#91; 'name' &#93;' should not be <span class="java&#45;keyword">null</span>"</span>,
            instance.errors&#91; 'name' &#93;
        assertEquals <span class="java&#45;quote">"'errors&#91; 'name' &#93;' should be 'blank'"</span>,
            'blank', instance.errors&#91; 'name' &#93;<p class="paragraph"/>    &#125;<p class="paragraph"/>    void testSizeTooLong() &#123;<p class="paragraph"/>        def instance = <span class="java&#45;keyword">new</span> Person()
        instance.name = 'A' &#42; 101
        assertFalse <span class="java&#45;quote">"'validate' should be <span class="java&#45;keyword">false</span>"</span>, instance.validate()
        assertNotNull <span class="java&#45;quote">"'errors&#91; 'name' &#93;' should not be <span class="java&#45;keyword">null</span>"</span>,
            instance.errors&#91; 'name' &#93;
        assertEquals <span class="java&#45;quote">"'errors&#91; 'name' &#93;' should be 'size'"</span>,
            'size', instance.errors&#91; 'name' &#93;<p class="paragraph"/>    &#125;<p class="paragraph"/>    void testNullable() &#123;<p class="paragraph"/>        def instance = <span class="java&#45;keyword">new</span> Person()
        instance.name = <span class="java&#45;keyword">null</span>
        assertFalse <span class="java&#45;quote">"'validate' should be <span class="java&#45;keyword">false</span>"</span>, instance.validate()
        assertNotNull <span class="java&#45;quote">"'errors&#91; 'name' &#93;' should not be <span class="java&#45;keyword">null</span>"</span>,
            instance.errors&#91; 'name' &#93;
        assertEquals <span class="java&#45;quote">"'errors&#91; 'name' &#93;' should be 'nullable'"</span>,
            'nullable', instance.errors&#91; 'name' &#93;<p class="paragraph"/>    &#125;<p class="paragraph"/>&#125;</pre></div>
As you can see, the plugin generates unit tests for all the constraints contained in the <code>name</code> property.
<blockquote class="note">
The plugin can manage all the constraints but <code>matches</code> and <code>validator</code>, due to their complexity. The plugin will generate the unit test method but you must set some values by hand. If you forget this, the method will throw an exception every time you run the test.
</blockquote>



<h2 id="spockUnitTestDomainClasses">4.1 Creating unit tests with Spock</h2>
Since the 0.2 version, you can generate unit tests for domain class constraints with the <a href="https://code.google.com/p/spock/" target="blank">Spock Framework</a> using the <a href="../ref/Scripts/create-unit-test-constraints-spock.html" class="Scripts">create-unit-test-constraints-spock</a> command:
<div class="code"><pre>grails create&#45;unit&#45;test&#45;constraints&#45;spock &#91;domainClass&#93;</pre></div>
You will get the following unit test files:
<ul class="star">
<li><code>test/unit/mypackage/PersonNameConstraintsSpec.groovy</code></li>
<li><code>test/unit/mypackage/PersonLastNameConstraintsSpec.groovy</code></li>
<li><code>test/unit/mypackage/PersonBirthdateConstraintsSpec.groovy</code></li>
<li><code>test/unit/mypackage/PersonEnabledConstraintsSpec.groovy</code></li>
</ul><p class="paragraph"/>If we open the <code>test/unit/mypackage/PersonNameConstraintsSpec.groovy</code> file, we will find something like this:
<div class="code"><pre><span class="java&#45;keyword">package</span> mypackage<p class="paragraph"/><span class="java&#45;keyword">import</span> grails.test.mixin.&#42;
<span class="java&#45;keyword">import</span> spock.lang.&#42;<p class="paragraph"/>@TestFor(Person)
class PersonNameConstraintsSpec <span class="java&#45;keyword">extends</span> Specification &#123;<p class="paragraph"/>    def setup() &#123;
        mockForConstraintsTests( Person, &#91; <span class="java&#45;keyword">new</span> Person() &#93; )
    &#125;<p class="paragraph"/>    @Ignore('See http://jira.grails.org/browse/GRAILS&#45;10474' )
    def <span class="java&#45;quote">"test 'blank' constraint"</span>() &#123;<p class="paragraph"/>        when:
            def instance = <span class="java&#45;keyword">new</span> Person( name:name )
            def result = instance.validate()
        then:
            result == <span class="java&#45;keyword">false</span>
            instance.errors&#91; 'name' &#93; != <span class="java&#45;keyword">null</span>
            instance.errors&#91; 'name' &#93; == 'blank'
        where:
            name = ''<p class="paragraph"/>    &#125;<p class="paragraph"/>    def <span class="java&#45;quote">"test 'sizeTooLong' constraint"</span>() &#123;<p class="paragraph"/>        when:
            def instance = <span class="java&#45;keyword">new</span> Person( name:name )
            def result = instance.validate()
        then:
            result == <span class="java&#45;keyword">false</span>
            instance.errors&#91; 'name' &#93; != <span class="java&#45;keyword">null</span>
            instance.errors&#91; 'name' &#93; == 'size'
        where:
            name = 'A' &#42; 101<p class="paragraph"/>    &#125;<p class="paragraph"/>    def <span class="java&#45;quote">"test 'nullable' constraint"</span>() &#123;<p class="paragraph"/>        when:
            def instance = <span class="java&#45;keyword">new</span> Person( name:name )
            def result = instance.validate()
        then:
            result == <span class="java&#45;keyword">false</span>
            instance.errors&#91; 'name' &#93; != <span class="java&#45;keyword">null</span>
            instance.errors&#91; 'name' &#93; == 'nullable'
        where:
            name = <span class="java&#45;keyword">null</span><p class="paragraph"/>    &#125;<p class="paragraph"/>&#125;</pre></div>
<blockquote class="note">
For versions of Grails prior to 2.3.0, you need to install the <a href="http://grails.org/plugin/spock" target="blank">Grails Spock Plugin</a> if you want to execute the tests.
</blockquote>



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/config.html">&lt;&lt; <strong>3</strong><span>Setting up the configuration</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/services.html"><strong>5</strong><span>Creating services</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Scripts</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-config-file.html">create-config-file</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-config.html">create-config</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-content-template.html">create-content-template</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-controller-class.html">create-controller-class</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-datasource-file.html">create-datasource-file</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-form-template.html">create-form-template</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-list-template.html">create-list-template</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-logs.html">create-logs</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-mock.html">create-mock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-properties-file.html">create-properties-file</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-service-class.html">create-service-class</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-service-create-log.html">create-service-create-log</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-service-delete-log.html">create-service-delete-log</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-service-get-log.html">create-service-get-log</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-service-list-log.html">create-service-list-log</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-service-update-log.html">create-service-update-log</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-constraints-spock.html">create-unit-test-constraints-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-constraints.html">create-unit-test-constraints</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-content-spock.html">create-unit-test-controller-content-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-content.html">create-unit-test-controller-content</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-create-spock.html">create-unit-test-controller-create-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-create.html">create-unit-test-controller-create</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-delete-spock.html">create-unit-test-controller-delete-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-delete.html">create-unit-test-controller-delete</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-edit-spock.html">create-unit-test-controller-edit-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-edit.html">create-unit-test-controller-edit</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-index-spock.html">create-unit-test-controller-index-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-index.html">create-unit-test-controller-index</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-list-spock.html">create-unit-test-controller-list-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-list.html">create-unit-test-controller-list</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-save-spock.html">create-unit-test-controller-save-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-save.html">create-unit-test-controller-save</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-spock.html">create-unit-test-controller-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-update-spock.html">create-unit-test-controller-update-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller-update.html">create-unit-test-controller-update</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-controller.html">create-unit-test-controller</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-create-spock.html">create-unit-test-service-create-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-create.html">create-unit-test-service-create</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-delete-spock.html">create-unit-test-service-delete-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-delete.html">create-unit-test-service-delete</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-get-spock.html">create-unit-test-service-get-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-get.html">create-unit-test-service-get</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-list-max-spock.html">create-unit-test-service-list-max-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-list-max.html">create-unit-test-service-list-max</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-list-offset-spock.html">create-unit-test-service-list-offset-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-list-offset.html">create-unit-test-service-list-offset</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-list-sort-order-spock.html">create-unit-test-service-list-sort-order-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-list-sort-order.html">create-unit-test-service-list-sort-order</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-list-spock.html">create-unit-test-service-list-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-list.html">create-unit-test-service-list</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-spock.html">create-unit-test-service-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-update-spock.html">create-unit-test-service-update-spock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service-update.html">create-unit-test-service-update</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-unit-test-service.html">create-unit-test-service</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-views-index.html">create-views-index</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/create-views.html">create-views</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/install-optimus-templates.html">install-optimus-templates</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/optimus-all.html">optimus-all</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
